<html>
	<head>
		<title>
			Personal Data Visualizations
		</title>
		<p class="BelowIsPatientData">
			This is your data visualization page!
		</p>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
		integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
		crossorigin=""/>
		<link rel="stylesheet" type="text/css" href="styles.css">
		<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
		<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
		integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
		crossorigin=""></script>
		<script type="text/javascript" src="database.js"></script>
		<script type='text/javascript' src='https://npmcdn.com/parse@2.1.0/dist/parse.min.js'></script>
			 <!-->#mapid { height: 500px;
			 		  width: 800px; }-->
		</style>
		<script type="text/javascript" src="navFunctions.js"></script>
	</head>
	<body style="background-color: Linen;" id="body" onload="createSymptomGraph(); createTempGraph();">
		<!--<div id="mapid" ></div>-->
		<div id="container" class="svg-container"></div>
		<div id="container2" class="svg-container"></div>
		<!--<script>
			var mymap = L.map('mapid').setView([39.8097343, -98.5556199], 4);
			const attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
			const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
			const tiles = L.tileLayer(tileUrl, {attribution});
			tiles.addTo(mymap);

	var dlist = [
			["Dunkin' Donuts", 41.331862, -72.974466],
			["Dunkin' Donuts", 41.538017, -72.807372],
			["Dunkin' Donuts", 41.363606, -72.923389],
			["Dunkin' Donuts", 41.239047, -73.035461],
			["Dunkin' Donuts", 41.468639, -73.023658],
			["Dunkin' Donuts", 41.371905, -72.072075],
			["Dunkin' Donuts", 41.738017, -72.667604],
			["Dunkin' Donuts", 41.610986, -72.875903],
			["Dunkin' Donuts", 41.772464, -72.641714],
			["Dunkin' Donuts", 41.828055, -73.110093],
			["Dunkin' Donuts", 41.148506, -73.245258],
			["Dunkin' Donuts", 41.286369, -72.817094],
			["Dunkin' Donuts", 41.561778, -73.054078],
			["Dunkin' Donuts", 41.296328, -72.951217],
			["Dunkin' Donuts", 41.199067, -73.129694],
			["Dunkin' Donuts", 41.039322, -73.596356],
			["Dunkin' Donuts", 41.397723, -73.451265],
			["Dunkin' Donuts", 41.305365, -72.926059],
			["Dunkin' Donuts", 41.743101, -72.716136],
			["Dunkin' Donuts", 41.721033, -72.667883],
			["Dunkin' Donuts", 41.294736, -72.379742],
			["Dunkin' Donuts", 41.216977, -73.213975],
			["Dunkin' Donuts", 41.386531, -72.159433],
			["Dunkin' Donuts", 41.713088, -72.218844],
			["Dunkin' Donuts", 41.41368, -73.378627],
			["Dunkin' Donuts", 41.601464, -73.406707],
			["Dunkin' Donuts", 41.75411, -71.87708],
			["Dunkin' Donuts", 41.75409, -71.87852],
			["Dunkin' Donuts", 41.04116, -73.67248],
			["Dunkin' Donuts", 41.04116, -73.67289],
			["Dunkin' Donuts", 41.24669, -73.00961],
			["Dunkin' Donuts", 41.24626, -73.00873],
			["Dunkin' Donuts", 41.0674, -73.50429],
			["Dunkin' Donuts", 41.08069, -73.46169],
			["Dunkin' Donuts", 41.39854, -72.869408],
			["Dunkin' Donuts", 41.398122, -72.868734],
			["Dunkin' Donuts", 41.21886, -73.25588],
			["Dunkin' Donuts", 41.21889, -73.25636],
			["Dunkin' Donuts", 41.27981, -73.04855],
			["Dunkin' Donuts", 41.27999, -73.04797],
			["Dunkin' Donuts", 41.14779, -73.25667],
			["Dunkin' Donuts", 41.47121, -72.11684],
			["Dunkin' Donuts", 41.28638, -72.83384],
			["Dunkin' Donuts", 41.28571, -72.83359],
			["Dunkin' Donuts", 41.552107, -73.063487],
			["Dunkin' Donuts", 41.475441, -72.263915],
			["Dunkin' Donuts", 41.49139, -72.09171],
			["Dunkin' Donuts", 41.032351, -73.56809],
			["Dunkin' Donuts", 41.85567, -72.70589],
			["Dunkin' Donuts", 41.825819, -72.896471],
			["Dunkin' Donuts", 41.440925, -71.802066],
			["Dunkin' Donuts", 41.74265, -72.710874],
			["Dunkin' Donuts", 41.767594, -72.696857],
			["Dunkin' Donuts", 41.146678, -73.493795],
			["Dunkin' Donuts", 41.56177, -72.651043],
			["Dunkin' Donuts", 41.666274, -72.781574],
			["Dunkin' Donuts", 41.660553, -72.918052],
			["Dunkin' Donuts", 41.618416, -72.899513],
			["Dunkin' Donuts", 41.715337, -72.763421],
			["Dunkin' Donuts", 41.052246, -73.516178],
			["Dunkin' Donuts", 41.386445, -73.444158],
			["Dunkin' Donuts", 41.927877, -72.707994],
			["Dunkin' Donuts", 41.762669, -71.899855],
			["Dunkin' Donuts", 41.15088, -73.424763],
			["Dunkin' Donuts", 41.31841, -72.22708],
			["Dunkin' Donuts", 41.64158, -72.923206]
		];


		for (var i = 0; i < dlist.length; i++) {
			circle = new L.circle([dlist[i][1], dlist[i][2]], 500, {
				fillOpacity: .8,
				color: '#ffa500',
				fillColor: '#ffa500',
				weight: 3,
				radius: 40,
				stroke: true
			})
				.bindPopup(dlist[i][0])
				.addTo(mymap);
		}
		</script>-->

<script>
	function createTempGraph(){
	
		const width = 960;
		const height = 500;
		const margin = 5;
		const padding = 5;
		const adj = 30;
		// we are appending SVG first
		const svg = d3.select("div#container").append("svg")
			.attr("preserveAspectRatio", "xMinYMin meet")
			.attr("viewBox", "-"
				  + adj + " -"
				  + adj + " "
				  + (width + adj *3) + " "
				  + (height + adj*3))
			.style("padding", padding)
			.style("margin", margin)
			.classed("svg-content", true);
		
		var fName = localStorage.getItem("fName");
		var lName = localStorage.getItem("lName");
		var birthdate = localStorage.getItem("birthdate")
		var temps = localStorage.getItem("temperature").split(",");
		var dates = localStorage.getItem("createdAt").split(",");
		
		var data = [];
		for(i=0; i<temps.length; i++){
			data[i] = ({date:dates[i], value:Number(temps[i])});
		}
		
		
		// X axis
		var x = d3.scaleBand()
		  .range([ 0, width ])
		  .domain(data.map(function(d) { return d.date; }))
		  .padding(0.2);
		svg.append("g")
		  .attr("transform", "translate(0," + height + ")")
		  .call(d3.axisBottom(x))
		  .selectAll("text")
			.attr("transform", "translate(-10,0)rotate(-45)")
			.style("text-anchor", "end");

		// Add Y axis
		var y = d3.scaleLinear()
		  .domain([90, 105])
		  .range([ height, 0]);
		svg.append("g")
		  .call(d3.axisLeft(y));
		  
		  // create a tooltip
		var Tooltip = d3.select("#container")
			.append("div")
			.style("opacity", 0)
			.attr("class", "tooltip")
			.style("background-color", "white")
			.style("border", "solid")
			.style("border-width", "2px")
			.style("border-radius", "5px")
			.style("padding", "5px")

		// Three function that change the tooltip when user hover / move / leave a cell
		var mouseover = function(d) {
		Tooltip
			.style("opacity", 1)
		d3.select(this)
			.style("stroke", "black")
			.style("opacity", 1)
		}
		var mousemove = function(d) {
		Tooltip
			.html("Temperature:" + d.value)
			.style("left", (d3.mouse(this)[0]+70) + "px")
			.style("top", (d3.mouse(this)[1]) + "px")
			.style("font-size", "14px");
		}
		var mouseleave = function(d) {
		Tooltip
			.style("opacity", 0)
		d3.select(this)
			.style("stroke", "none")
			.style("opacity", 0.8)
		}

		// Bars
		svg.selectAll("mybar")
		  .data(data)
		  .enter()
		  .append("rect")
			.attr("x", function(d) { return x(d.date); })
			.attr("y", function(d) { return y(d.value); })
			.attr("width", x.bandwidth())
			.attr("height", function(d) { return height - y(d.value); })
			.attr("fill", "#69b3a2")
		.on("mouseover", mouseover)
    	.on("mousemove", mousemove)
    	.on("mouseleave", mouseleave)
		
		
		
		
		/*
		//------------------------1. PREPARATION------------------------//
		//-----------------------------SVG------------------------------//
		const width = 960;
		const height = 500;
		const margin = 5;
		const padding = 5;
		const adj = 30;
		// we are appending SVG first
		const svg = d3.select("div#container").append("svg")
			.attr("preserveAspectRatio", "xMinYMin meet")
			.attr("viewBox", "-"
				  + adj + " -"
				  + adj + " "
				  + (width + adj *3) + " "
				  + (height + adj*3))
			.style("padding", padding)
			.style("margin", margin)
			.classed("svg-content", true);
	
		//-----------------------------DATA-----------------------------//
		const timeConv = d3.timeParse("%d-%b-%Y");
		const dataset = d3.csv("data.csv");
		
		dataset.then(function(data) {
			var slices = data.columns.slice(1).map(function(id) {
				return {
					id: id,
					values: data.map(function(d){
						return {
							date: timeConv(d.date),
							measurement: +d[id]
						};
					})
				};
			});
	
		//----------------------------SCALES----------------------------//
		const xScale = d3.scaleTime().range([0,width]);
		const yScale = d3.scaleLinear().rangeRound([height, 0]);
		xScale.domain(d3.extent(data, function(d){
			return timeConv(d.date)}));
	
		yScale.domain([(0), d3.max(slices, function(c) {
			return d3.max(c.values, function(d) {
				return d.measurement + 4; });
				})
			]);
	
		//-----------------------------AXES-----------------------------//
		const yaxis = d3.axisLeft()
			.ticks((slices[0].values).length)
			.scale(yScale);
	
		const xaxis = d3.axisBottom()
			.ticks(d3.timeDay.every(1))
			.tickFormat(d3.timeFormat('%b %d'))
			.scale(xScale);
	
		//----------------------------LINES-----------------------------//
		const line = d3.line()
			.x(function(d) { return xScale(d.date); })
			.y(function(d) { return yScale(d.measurement); });
	
		let id = 0;
		const ids = function () {
			return "line-"+id++;
		}  
	
		//---------------------------TOOLTIP----------------------------//
		const tooltip = d3.select("body").append("div")
			.attr("class", "tooltip")
			.style("opacity", 0)
			.style("position", "absolute");
	
		//-------------------------2. DRAWING---------------------------//
		//-----------------------------AXES-----------------------------//
		svg.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0," + height + ")")
			.call(xaxis);
	
		svg.append("g")
			.attr("class", "axis")
			.call(yaxis)
			.append("text")
			.attr("transform", "rotate(-90)")
			.attr("dy", ".75em")
			.attr("y", 6)
			.style("text-anchor", "end")
			.text("Frequency");
	
		//----------------------------LINES-----------------------------//
		const lines = svg.selectAll("lines")
			.data(slices)
			.enter()
			.append("g");
	
		lines.append("path")
			.attr("class", ids)
			.attr("d", function(d) { return line(d.values); });
	
		lines.append("text")
			.attr("class","serie_label")
			.datum(function(d) {
				return {
					id: d.id,
					value: d.values[d.values.length - 1]}; })
			.attr("transform", function(d) {
					return "translate(" + (xScale(d.value.date) + 10)  
					+ "," + (yScale(d.value.measurement) + 5 )+ ")"; })
			.attr("x", 5)
			.text(function(d) { return ("Serie ") + d.id; });
	
		//---------------------------POINTS-----------------------------// 
		lines.selectAll("points")
			.data(function(d) {return d.values})
			.enter()
			.append("circle")
			.attr("cx", function(d) { return xScale(d.date); })      
			.attr("cy", function(d) { return yScale(d.measurement); })    
			.attr("r", 1)
			.attr("class","point")
			.style("opacity", 1);
	
		//---------------------------EVENTS-----------------------------//    
		lines.selectAll("circles")
			.data(function(d) { return(d.values); } )
			.enter()
			.append("circle")
			.attr("cx", function(d) { return xScale(d.date); })      
			.attr("cy", function(d) { return yScale(d.measurement); })    
			.attr('r', 10)
			.style("opacity", 0)
			.on('mouseover', function(d) {
				tooltip.transition()
					.delay(30)
					.duration(200)
					.style("opacity", 1);
	
				tooltip.html(d.measurement)
					.style("left", (d3.event.pageX + 25) + "px")
					.style("top", (d3.event.pageY) + "px");
	
				const selection = d3.select(this).raise();
	
				selection
					.transition()
					.delay("20")
					.duration("200")
					.attr("r", 6)
					.style("opacity", 1)
					.style("fill","#ed3700");
			})                
			.on("mouseout", function(d) {      
				tooltip.transition()        
					.duration(100)      
					.style("opacity", 0);  
	
				const selection = d3.select(this);
	
				selection
					.transition()
					.delay("20")
					.duration("200")
					.attr("r", 10)
					.style("opacity", 0);
			});
	
		});*/
	}
	
	function createSymptomGraph(){
		const width = 960;
		const height = 500;
		const margin = 5;
		const padding = 5;
		const adj = 30;
		// we are appending SVG first
		const svg = d3.select("div#container2").append("svg")
			.attr("preserveAspectRatio", "xMinYMin meet")
			.attr("viewBox", "-"
				  + adj + " -"
				  + adj + " "
				  + (width + adj *3) + " "
				  + (height + adj*3))
			.style("padding", padding)
			.style("margin", margin)
			.classed("svg-content", true);
		
		var fName = localStorage.getItem("fName");
		var lName = localStorage.getItem("lName");
		var birthdate = localStorage.getItem("birthdate");
		var symptomsList = localStorage.getItem("symptomslist").split(",");
		var symptoms = localStorage.getItem("symptomcount").split(",");
		var dates = localStorage.getItem("createdAt").split(",");
		
		var data = [];
		for(i=0; i<symptoms.length; i++){
			data[i] = ({date:dates[i], value:Number(symptoms[i]), symptoms:symptomsList[i]});
		}
		
		
		// X axis
		var x = d3.scaleBand()
		  .range([ 0, width ])
		  .domain(data.map(function(d) { return d.date; }))
		  .padding(0.2);
		svg.append("g")
		  .attr("transform", "translate(0," + height + ")")
		  .call(d3.axisBottom(x))
		  .selectAll("text")
			.attr("transform", "translate(-10,0)rotate(-45)")
			.style("text-anchor", "end");

		// Add Y axis
		var y = d3.scaleLinear()
		  .domain([0, 15])
		  .range([ height, 0]);
		svg.append("g")
		  .call(d3.axisLeft(y));
		  
		// create a tooltip
		var Tooltip = d3.select("#container2")
			.append("div")
			.style("opacity", 0)
			.attr("class", "tooltip")
			.style("background-color", "white")
			.style("border", "solid")
			.style("border-width", "2px")
			.style("border-radius", "5px")
			.style("padding", "5px")

		// Three function that change the tooltip when user hover / move / leave a cell
		var mouseover = function(d) {
		Tooltip
			.style("opacity", 1)
		d3.select(this)
			.style("stroke", "black")
			.style("opacity", 1)
		}
		var mousemove = function(d) {
		Tooltip
			.html("Symptoms are:" + d.symptoms)
			.style("left", (d3.mouse(this)[0]+70) + "px")
			.style("top", (d3.mouse(this)[1]) + "px")
			.style("font-size", "14px");
		}
		var mouseleave = function(d) {
		Tooltip
			.style("opacity", 0)
		d3.select(this)
			.style("stroke", "none")
			.style("opacity", 0.8)
		}

		// Bars
		svg.selectAll("mybar")
		  .data(data)
		  .enter()
		  .append("rect")
			.attr("x", function(d) { return x(d.date); })
			.attr("y", function(d) { return y(d.value); })
			.attr("width", x.bandwidth())
			.attr("height", function(d) { return height - y(d.value); })
			.attr("fill", "#BD371A")
		.on("mouseover", mouseover)
    	.on("mousemove", mousemove)
    	.on("mouseleave", mouseleave)
	}
	</script>
	</body>
</html>
